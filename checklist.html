<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Checklist de Salida ‚Äî Mar Azul</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
  <style>
    .task-completed {
      background-color: rgba(16,185,129,0.08);
      color: #065f46;
    }
    .task-pending {
      background-color: rgba(250,204,21,0.06);
      color: #92400e;
    }
    .scroll-mt-20 { scroll-margin-top: 5rem; }
    .is-editing .display-mode { display: none; }
    .is-editing .edit-mode { display: block; }
    .edit-mode { display: none; }
    .admin-tooltip {
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.2s, visibility 0.2s;
    }
    .admin-toggle-btn:hover .admin-tooltip {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body class="bg-slate-50 font-sans text-slate-800">

  <!-- Header -->
  <header class="bg-white shadow sticky top-0 z-20">
    <div class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-teal-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 9.75V19.5A1.5 1.5 0 004.5 21h15a1.5 1.5 0 001.5-1.5V9.75"/></svg>
          <h1 class="text-lg font-bold">Gu√≠a Mar Azul</h1>
        </div>
        <nav class="hidden lg:flex items-center space-x-4">
          <a href="index.html" class="text-sm text-slate-600 hover:text-slate-900">Inicio</a>
          <a href="checklist.html" class="text-sm text-slate-600 hover:text-slate-900 font-medium">Checklist de salida</a>
        </nav>
        <div class="lg:hidden">
          <button id="mobile-menu-btn" class="p-2 rounded-md text-slate-500 hover:text-slate-800 hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-teal-500" aria-label="Abrir men√∫ m√≥vil">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
          </button>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto max-w-3xl p-6">
    <h2 class="text-2xl font-extrabold mb-2">Checklist de salida</h2>
    <p class="mb-6 text-slate-600">Marque las tareas que ya complet√≥ antes de dejar la casa. Si sos admin pod√©s editar la lista.</p>

    <!-- Checklist container -->
    <section id="checklist" class="space-y-3">
      <!-- Items will be rendered here -->
    </section>

    <!-- Controls -->
    <div class="mt-6 flex items-center justify-between gap-4">
      <div class="flex items-center gap-2">
        <button id="reset-btn" class="px-4 py-2 rounded-md border text-sm bg-white hover:bg-slate-50">Reiniciar estado</button>
        <button id="clear-btn" class="px-4 py-2 rounded-md border text-sm bg-white hover:bg-slate-50 text-red-600">Borrar todas las tareas</button>
      </div>

      <div class="text-sm text-slate-500">
        Estado guardado en tu navegador (local).
      </div>
    </div>
  </main>

  <!-- Admin Toggle Button -->
  <div class="fixed bottom-6 right-6 z-30">
    <button id="admin-toggle-btn" class="admin-toggle-btn relative flex items-center justify-center w-14 h-14 rounded-full text-white shadow-lg bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
      <svg id="admin-icon" xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685"/></svg>
      <div class="admin-tooltip absolute -top-10 right-0 p-2 text-xs text-white rounded-md shadow-md bg-blue-600 whitespace-nowrap">Editar checklist</div>
    </button>
  </div>

  <!-- Login Modal (same behavior as index.html) -->
  <div id="login-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center p-4">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6">
      <h3 class="text-xl font-semibold text-center mb-4">Acceso de Administrador</h3>
      <form id="login-form" class="space-y-4">
        <div>
          <label for="username" class="block text-sm font-medium text-slate-700">Usuario</label>
          <input id="username" name="username" required class="mt-1 block w-full border rounded-md p-2" placeholder="Usuario">
        </div>
        <div>
          <label for="password-input" class="block text-sm font-medium text-slate-700">Contrase√±a</label>
          <input id="password-input" name="password-input" type="password" required class="mt-1 block w-full border rounded-md p-2" placeholder="Contrase√±a">
        </div>
        <p id="login-error" class="text-sm text-red-600 hidden"></p>
        <div class="flex gap-2">
          <button id="login-cancel-btn" type="button" class="flex-1 py-2 bg-white border rounded-md">Cancelar</button>
          <button type="submit" class="flex-1 py-2 bg-blue-600 text-white rounded-md">Ingresar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Admin editing panel (inline) -->
  <div id="admin-panel" class="hidden fixed left-1/2 -translate-x-1/2 bottom-24 z-40 w-full max-w-2xl p-4">
    <div class="bg-white p-4 rounded-xl shadow-lg">
      <div class="flex items-center justify-between mb-3">
        <h4 class="font-semibold">Modo edici√≥n ‚Äî Checklist</h4>
        <div class="flex items-center gap-2">
          <button id="admin-save-btn" class="px-3 py-1 text-sm bg-emerald-600 text-white rounded-md">Guardar</button>
          <button id="admin-cancel-edit" class="px-3 py-1 text-sm bg-slate-100 rounded-md">Cerrar</button>
        </div>
      </div>
      <div class="flex gap-2 mb-3">
        <input id="new-task-input" class="flex-1 border rounded-md p-2" placeholder="Nueva tarea (ej: Lavar los platos)">
        <button id="add-task-btn" class="px-3 py-2 bg-blue-600 text-white rounded-md">Agregar</button>
      </div>
      <p class="text-sm text-slate-500">Haz clic en el √≠cono de l√°piz junto a cada tarea para editar o en la papelera para eliminarla.</p>
    </div>
  </div>

  <footer class="text-center text-slate-500 py-8 mt-12">
    <p>Gracias por ayudar a dejar la casa en orden. üíô</p>
  </footer>

<script>
(function(){
  // Credentials (same as main)
  const ADMIN_USER = 'Rsmith';
  const ADMIN_PASS = '123-asd';

  // LocalStorage keys
  const TASKS_KEY = 'marazul_checklist_tasks';
  const STATE_KEY = 'marazul_checklist_state';

  // Default tasks
  const DEFAULT_TASKS = [
    'Cerrar todas las ventanas',
    'Apagar las luces interiores',
    'Apagar calefacci√≥n / le√±a',
    'Cerrar llave de paso del gas',
    'Sacar la basura y dejar los residuos en el punto de recolecci√≥n',
    'Devolver las llaves a la caja / lugar acordado',
    'Revisar que no queden objetos personales',
  ];

  // State
  let tasks = []; // array of {id, text}
  let checked = {}; // id => boolean
  let isAdmin = false;
  let isEditing = false;

  // Elements
  const checklistEl = document.getElementById('checklist');
  const loginModal = document.getElementById('login-modal');
  const loginForm = document.getElementById('login-form');
  const loginError = document.getElementById('login-error');
  const adminToggleBtn = document.getElementById('admin-toggle-btn');
  const adminPanel = document.getElementById('admin-panel');
  const adminSaveBtn = document.getElementById('admin-save-btn');
  const adminCancelEdit = document.getElementById('admin-cancel-edit');
  const newTaskInput = document.getElementById('new-task-input');
  const addTaskBtn = document.getElementById('add-task-btn');
  const resetBtn = document.getElementById('reset-btn');
  const clearBtn = document.getElementById('clear-btn');

  // Utilities
  const uid = () => 't_' + Math.random().toString(36).slice(2,9);

  function loadFromStorage(){
    try {
      const rawTasks = localStorage.getItem(TASKS_KEY);
      const rawState = localStorage.getItem(STATE_KEY);
      tasks = rawTasks ? JSON.parse(rawTasks) : DEFAULT_TASKS.map(t => ({ id: uid(), text: t }));
      checked = rawState ? JSON.parse(rawState) : {};
    } catch(e) {
      console.error('Error leyendo localStorage', e);
      tasks = DEFAULT_TASKS.map(t => ({ id: uid(), text: t }));
      checked = {};
    }
  }

  function saveToStorage(){
    localStorage.setItem(TASKS_KEY, JSON.stringify(tasks));
    localStorage.setItem(STATE_KEY, JSON.stringify(checked));
  }

  function render(){
    checklistEl.innerHTML = '';
    if (!tasks.length){
      checklistEl.innerHTML = '<p class="text-slate-500">No hay tareas definidas.</p>';
      return;
    }

    tasks.forEach((task, idx) => {
      const done = !!checked[task.id];
      const wrapper = document.createElement('div');
      wrapper.className = 'p-3 rounded-md flex items-center justify-between shadow-sm transition-colors';
      wrapper.classList.add(done ? 'task-completed' : 'task-pending');

      // Left: checkbox + label
      const left = document.createElement('div');
      left.className = 'flex items-center gap-3';

      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = done;
      checkbox.className = 'h-5 w-5';
      checkbox.addEventListener('change', () => {
        checked[task.id] = checkbox.checked;
        saveToStorage();
        render();
      });

      const label = document.createElement('div');
      label.className = 'text-sm';
      label.innerText = task.text;

      left.appendChild(checkbox);
      left.appendChild(label);

      // Right: edit icons (only visible in admin/edit mode)
      const right = document.createElement('div');
      right.className = 'flex items-center gap-2';

      // Display mode: pencil & trash hidden unless editing
      const displayControls = document.createElement('div');
      displayControls.className = 'display-mode flex items-center gap-2';
      displayControls.style.display = isEditing ? 'none' : 'flex';

      const editBtn = document.createElement('button');
      editBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.232 5.232l3.536 3.536M9 11l6 6L21 11"/></svg>';
      editBtn.title = 'Editar tarea';
      editBtn.addEventListener('click', () => enterEditFor(task.id));

      const delBtn = document.createElement('button');
      delBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"/></svg>';
      delBtn.title = 'Eliminar tarea';
      delBtn.addEventListener('click', () => {
        if (!confirm('Eliminar tarea?')) return;
        tasks = tasks.filter(t => t.id !== task.id);
        delete checked[task.id];
        saveToStorage();
        render();
      });

      displayControls.appendChild(editBtn);
      displayControls.appendChild(delBtn);

      // Edit mode controls (inline): textarea + save/cancel
      const editModeControls = document.createElement('div');
      editModeControls.className = 'edit-mode flex items-center gap-2';
      editModeControls.style.display = isEditing ? 'flex' : 'none';

      const input = document.createElement('input');
      input.type = 'text';
      input.value = task.text;
      input.className = 'border rounded-md p-1 text-sm';

      const saveInline = document.createElement('button');
      saveInline.className = 'px-2 py-1 bg-emerald-600 text-white rounded-md text-sm';
      saveInline.innerText = 'Guardar';
      saveInline.addEventListener('click', () => {
        task.text = input.value.trim() || task.text;
        saveToStorage();
        render();
      });

      const cancelInline = document.createElement('button');
      cancelInline.className = 'px-2 py-1 bg-slate-100 rounded-md text-sm';
      cancelInline.innerText = 'Cancelar';
      cancelInline.addEventListener('click', () => render());

      editModeControls.appendChild(input);
      editModeControls.appendChild(saveInline);
      editModeControls.appendChild(cancelInline);

      right.appendChild(displayControls);
      right.appendChild(editModeControls);

      wrapper.appendChild(left);
      wrapper.appendChild(right);
      checklistEl.appendChild(wrapper);
    });
  }

  function enterEditFor(id){
    // toggle global edit mode on (admin)
    if (!isAdmin) return alert('Necesit√°s acceso de administrador para editar la lista.');
    isEditing = true;
    document.body.classList.add('is-editing');
    adminPanel.classList.remove('hidden');
    render();
  }

  // Admin flow
  adminToggleBtn.addEventListener('click', () => {
    if (isAdmin) {
      // toggle editing state
      isEditing = !isEditing;
      document.body.classList.toggle('is-editing', isEditing);
      adminPanel.classList.toggle('hidden', !isEditing);
      return;
    }
    // show login
    loginModal.classList.remove('hidden');
  });

  loginForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const u = e.target.elements.username.value;
    const p = e.target.elements['password-input'].value;
    if (u === ADMIN_USER && p === ADMIN_PASS) {
      isAdmin = true;
      isEditing = true;
      document.body.classList.add('is-editing');
      loginModal.classList.add('hidden');
      loginError.classList.add('hidden');
      adminPanel.classList.remove('hidden');
      render();
    } else {
      loginError.innerText = 'Usuario o contrase√±a incorrectos.';
      loginError.classList.remove('hidden');
    }
  });

  document.getElementById('login-cancel-btn').addEventListener('click', () => {
    loginModal.classList.add('hidden');
    loginError.classList.add('hidden');
  });

  adminCancelEdit.addEventListener('click', () => {
    isEditing = false;
    document.body.classList.remove('is-editing');
    adminPanel.classList.add('hidden');
    render();
  });

  adminSaveBtn.addEventListener('click', () => {
    // Save already done inline and on add/delete. Just close editing mode.
    isEditing = false;
    document.body.classList.remove('is-editing');
    adminPanel.classList.add('hidden');
    saveToStorage();
    render();
    alert('Cambios guardados localmente.');
  });

  addTaskBtn.addEventListener('click', () => {
    const text = newTaskInput.value.trim();
    if (!text) return;
    const t = { id: uid(), text };
    tasks.push(t);
    newTaskInput.value = '';
    saveToStorage();
    render();
  });

  newTaskInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') addTaskBtn.click();
  });

  resetBtn.addEventListener('click', () => {
    if (!confirm('Reiniciar marca de completadas (no borra tareas)?')) return;
    checked = {};
    saveToStorage();
    render();
  });

  clearBtn.addEventListener('click', () => {
    if (!confirm('Eliminar todas las tareas?')) return;
    tasks = [];
    checked = {};
    saveToStorage();
    render();
  });

  // Init
  loadFromStorage();
  render();

  // expose for debug
  window.MARAZUL_CHECKLIST = {
    get tasks(){ return tasks; },
    get checked(){ return checked; },
    save: saveToStorage,
    load: loadFromStorage,
    render
  };
})();
</script>

</body>
</html>